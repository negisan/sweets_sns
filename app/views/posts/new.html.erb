<h1>Posts#new</h1>
<p>Find me in app/views/posts/new.html.erb</p>

<div class='mt-3'>
  <%= form_with model: @post, local: true do |f| %>
    <div class='imagePreview'></div>
    <div class="input-group">
      <label class="input-group-btn">
        <span class="btn btn-primary">
          画像を選択<%= f.file_field :post_image, style: 'display:none' %>
        </span>
      </label>
      <input type="text" class="form-control" readonly="">
    </div>
    <div class="form-group">
      <%= f.label :post_body, 'ひとこと' %>
      <%= f.text_area :post_body, class: 'form-control' %>
    </div>
    <div class="nav justify-content-end mt-3">
      <%= f.submit '送信', class: 'btn btn-primary' %>
    </div>
  <% end %>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
  $(document).on('change', ':file', function() {
      var input = $(this),
      numFiles = input.get(0).files ? input.get(0).files.length : 1,
      label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
      input.parent().parent().next(':text').val(label);

      var files = !!this.files ? this.files : [];
      if (!files.length || !window.FileReader) return;
      if (/^image/.test( files[0].type)){
          var reader = new FileReader();
          reader.readAsDataURL(files[0]);
          reader.onloadend = function(){
              input.parent().parent().parent().prev('.imagePreview').css("background-image", "url("+this.result+")");
              input.parent().parent().parent().prev('.imagePreview').css("height", "400px");
          }
      }
  });
</script>